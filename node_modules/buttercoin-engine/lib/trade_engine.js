// Generated by CoffeeScript 1.6.3
(function() {
  var Amount, DataStore, Q, TradeEngine, op,
    __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  Q = require('q');

  op = require('./operations');

  DataStore = require('./datastore/datastore');

  Amount = require('./datastore/amount');

  module.exports = TradeEngine = (function() {
    function TradeEngine() {
      this.execute_operation = __bind(this.execute_operation, this);
      var _this = this;
      this.datastore = new DataStore();
      this.operation_handlers = {};
      this.operation_handlers[op.ADD_DEPOSIT] = function(op) {
        return _this.datastore.deposit(op);
      };
      this.operation_handlers[op.WITHDRAW_FUNDS] = function(op) {
        return _this.datastore.withdraw(op);
      };
      this.operation_handlers[op.CREATE_LIMIT_ORDER] = this.datastore.place_order;
    }

    TradeEngine.prototype.execute_operation = function(op) {
      if (!(op != null ? op.kind : void 0)) {
        throw Error("Invalid Operation: " + JSON.stringify(op));
      }
      if (this.operation_handlers[op.kind]) {
        return this.operation_handlers[op.kind](op);
      } else {
        throw Error("Unknown Operation: " + JSON.stringify(op));
      }
    };

    return TradeEngine;

  })();

}).call(this);
